<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoundTrack Travel - Internal Prototype (Skyscanner Integrated)</title>
    <style>
        :root {
            --primary: #6366f1; /* Indigo */
            --accent: #ec4899; /* Pink */
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f8fafc;
            --text-muted: #94a3b8;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
        }

        /* Utility */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .btn {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .btn:hover { transform: scale(1.05); }
        .hidden { display: none; }
        h1, h2, h3 { margin-top: 0; }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #334155;
            margin-bottom: 30px;
        }
        .logo { font-size: 1.5rem; font-weight: 800; letter-spacing: -1px; }
        .logo span { color: var(--accent); }

        /* GRID VIEW (Events) */
        .grid-header { margin-bottom: 20px; }
        .concert-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        .event-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        .event-card:hover { transform: translateY(-5px); }
        .card-img {
            height: 180px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .date-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .card-body { padding: 20px; }
        .artist-name { font-size: 1.25rem; font-weight: 700; margin-bottom: 5px; }
        .venue-info { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 15px; display: flex; align-items: center; gap: 5px; }
        
        /* PLANNER VIEW */
        .planner-header {
            background: linear-gradient(to right, var(--card-bg), var(--bg));
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid var(--accent);
        }
        .back-link { cursor: pointer; color: var(--text-muted); text-decoration: underline; display: inline-block; margin-bottom: 10px;}
        
        /* Product Cards in Planner */
        .travel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .travel-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #334155;
        }
        .travel-card h3 { color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        
        .mock-input {
            background: #0f172a;
            border: 1px solid #475569;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            color: #cbd5e1;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
        }
        .highlight { color: var(--accent); font-weight: bold; }

        /* Insights Section */
        .insights-section {
            background: rgba(99, 102, 241, 0.1);
            padding: 25px;
            border-radius: 12px;
        }
        .insight-tags { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;}
        .tag { background: var(--primary); padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo">Meta<span>Music</span></div>
        <div style="font-size: 0.9rem; color: var(--text-muted);">User Location: <span style="color:#fff">Detected (Singapore)</span></div>
    </header>

    <div id="discovery-view">
        <div class="grid-header">
            <h2>Upcoming Shows for You</h2>
            <p style="color: var(--text-muted);">Based on your Spotify history & tracked artists.</p>
        </div>
        <div class="concert-grid" id="events-container">
            </div>
    </div>

    <div id="planner-view" class="hidden">
        <div onclick="toggleView()" class="back-link">‚Üê Back to Events</div>
        
        <div class="planner-header">
            <h1 id="plan-title">Trip to Tokyo</h1>
            <p id="plan-subtitle">Seeing <strong>Coldplay</strong> at Tokyo Dome</p>
            <div style="margin-top: 10px; display: flex; gap: 15px; font-size: 0.9rem; color: var(--text-muted);">
                <span>üìÖ Date: <span id="plan-date" style="color:white">Nov 12</span></span>
                <span>üìç Origin: <span style="color:white">Singapore (SIN)</span></span>
            </div>
        </div>

        <h3>Build Your Itinerary</h3>
        <div class="travel-grid">
            <div class="travel-card">
                <h3>‚úàÔ∏è Flights</h3>
                <div class="mock-input">
                    <span>From: <strong>SIN</strong></span>
                    <span id="flight-origin-name">Singapore</span>
                    <span>To: <strong id="flight-dest-code">NRT</strong></span>
                    <span id="flight-dest-name">Tokyo</span>
                </div>
                <div class="mock-input">
                    <span>Depart: <strong id="flight-date-out">Nov 11</strong></span>
                    <span>Return: <strong id="flight-date-ret">Nov 13</strong></span>
                </div>
                <button class="btn" style="width: 100%; margin-top: 10px;" onclick="searchTravel('flights')">Search Flights üöÄ</button>
            </div>

            <div class="travel-card">
                <h3>üè® Hotels</h3>
                <div class="mock-input">
                    <span>City: <strong id="hotel-city-name">Tokyo</strong></span>
                </div>
                <div class="mock-input">
                    <span>Area: <strong id="hotel-area">Near Tokyo Dome</strong></span>
                </div>
                <div class="mock-input">
                    <span>Check-in: <strong id="hotel-checkin">Nov 11</strong></span>
                </div>
                <p style="font-size: 0.8rem; color: var(--text-muted);">We search for rooms near the venue.</p>
                <button class="btn" style="width: 100%; margin-top: 10px;" onclick="searchTravel('hotels')">View Hotels üõå</button>
            </div>

            <div class="travel-card">
                <h3>üöó Car / Transfer</h3>
                <div class="mock-input">
                    <span>Pick-up: <strong id="car-loc">Airport</strong></span>
                </div>
                <p style="font-size: 0.8rem; color: var(--text-muted);">Book transport from ${flight-dest-code} airport.</p>
                <button class="btn" style="width: 100%; margin-top: 10px;" onclick="searchTravel('cars')">View Options üöò</button>
            </div>
        </div>

        <div class="insights-section">
            <h3>üí° Local Vibes & Insights</h3>
            <p id="insight-text">Since you are going to Tokyo, check out the late-night Izakayas after the show.</p>
            <div class="insight-tags" id="insight-tags">
                <span class="tag">Late Night Food</span>
                <span class="tag">Safe Solo Travel</span>
                <span class="tag">Public Transport 24/7</span>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Configuration ---
    const USER_ORIGIN_CODE = "SIN";
    const USER_ORIGIN_NAME = "Singapore";

    // 1. Mock Data (9 Events)
    const events = [
        { id: 1, artist: "Coldplay", city: "Tokyo", code: "NRT", venue: "Tokyo Dome", date: "2025-11-12", airportName: "Narita", img: "https://images.unsplash.com/photo-1459749411177-0473ef7169ac?auto=format&fit=crop&w=800&q=80", insight: "Tokyo is huge! Stay near the Dome to avoid rush hour trains.", tags: ["Ramen", "Electronics", "Temples"] },
        { id: 2, artist: "Taylor Swift", city: "London", code: "LHR", venue: "Wembley Stadium", date: "2025-08-15", airportName: "Heathrow", img: "https://images.unsplash.com/photo-1540039155733-5bb30b53aa14?auto=format&fit=crop&w=800&q=80", insight: "Wembley is iconic. Grab a pint at a local pub before the gates open.", tags: ["Pub Culture", "History", "Tube"] },
        { id: 3, artist: "The Weeknd", city: "Paris", code: "CDG", venue: "Stade de France", date: "2025-07-22", airportName: "Charles de Gaulle", img: "https://images.unsplash.com/photo-1502602898657-3e91760cbb34?auto=format&fit=crop&w=800&q=80", insight: "The venue is slightly north of the center. Book a hotel in the 18th Arr. for easier access.", tags: ["Art", "Wine", "Fashion"] },
        { id: 4, artist: "Bad Bunny", city: "Miami", code: "MIA", venue: "Hard Rock Stadium", date: "2025-09-10", airportName: "International", img: "https://images.unsplash.com/photo-1535498730771-e735b998cd64?auto=format&fit=crop&w=800&q=80", insight: "It will be humid! Rent a convertible to drive down Ocean Drive.", tags: ["Beaches", "Nightlife", "Art Deco"] },
        { id: 5, artist: "BTS", city: "Seoul", code: "ICN", venue: "Olympic Stadium", date: "2025-10-05", airportName: "Incheon", img: "https://images.unsplash.com/photo-1538485399081-7191377e8241?auto=format&fit=crop&w=800&q=80", insight: "The fan culture here is unmatched. Visit the HYBE museum while you are in town.", tags: ["K-Pop", "BBQ", "Cafes"] },
        { id: 6, artist: "Adele", city: "Las Vegas", code: "LAS", venue: "Caesars Palace", date: "2025-12-30", airportName: "McCarran", img: "https://images.unsplash.com/photo-1605833556294-ea5c7a94f394?auto=format&fit=crop&w=800&q=80", insight: "Stay right on the strip. Walking distances are longer than they look.", tags: ["Casinos", "Shows", "Luxury"] },
        { id: 7, artist: "Ed Sheeran", city: "Melbourne", code: "MEL", venue: "MCG", date: "2026-02-14", airportName: "Tullamarine", img: "https://images.unsplash.com/photo-1514395465013-2dc046652fd8?auto=format&fit=crop&w=800&q=80", insight: "Melbourne has the best coffee in the world. The trams are free in the CBD.", tags: ["Coffee", "Sports", "Art Laneways"] },
        { id: 8, artist: "Dua Lipa", city: "Barcelona", code: "BCN", venue: "Palau Sant Jordi", date: "2025-06-20", airportName: "El Prat", img: "https://images.unsplash.com/photo-1583422409516-2895a77efded?auto=format&fit=crop&w=800&q=80", insight: "The concert starts late here. Enjoy tapas until 9 PM.", tags: ["Architecture", "Beach", "Tapas"] },
        { id: 9, artist: "Metallica", city: "Berlin", code: "BER", venue: "Olympiastadion", date: "2025-05-18", airportName: "Brandenburg", img: "https://images.unsplash.com/photo-1560969184-10fe8719e047?auto=format&fit=crop&w=800&q=80", insight: "Berlin nightlife is legendary. The public transport system (U-Bahn) is excellent.", tags: ["History", "Techno", "Beer"] },
    ];
    
    let currentEvent = null; // Store the currently selected event data

    // 2. Helper Functions
    function formatDateForDisplay(dateStr) {
        return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }
    
    function formatDateForUrl(dateStr) {
        // Formats YYYY-MM-DD
        return new Date(dateStr).toISOString().slice(0, 10);
    }
    
    function getTripDates(eventDateStr) {
        const eventDate = new Date(eventDateStr);
        
        const departDate = new Date(eventDate);
        departDate.setDate(departDate.getDate() - 1);
        
        const returnDate = new Date(eventDate);
        returnDate.setDate(returnDate.getDate() + 1);
        
        return {
            depart: departDate,
            return: returnDate
        };
    }

    // 3. Render Discovery View
    function renderEvents() {
        const container = document.getElementById('events-container');
        container.innerHTML = events.map(event => `
            <div class="event-card">
                <div class="card-img" style="background-image: url('${event.img}')">
                    <div class="date-badge">${formatDateForDisplay(event.date)}</div>
                </div>
                <div class="card-body">
                    <div class="artist-name">${event.artist}</div>
                    <div class="venue-info">üìç ${event.venue}, ${event.city}</div>
                    <button class="btn" onclick="openPlanner(${event.id})">Plan Trip ‚úàÔ∏è</button>
                </div>
            </div>
        `).join('');
    }

    // 4. Logic to Switch Views & Populate Data
    function openPlanner(id) {
        const event = events.find(e => e.id === id);
        currentEvent = event; // Set global variable
        const tripDates = getTripDates(event.date);
        
        // Populate Header Text
        document.getElementById('plan-title').innerText = `Trip to ${event.city}`;
        document.getElementById('plan-subtitle').innerHTML = `Seeing <strong>${event.artist}</strong> at ${event.venue}`;
        document.getElementById('plan-date').innerText = formatDateForDisplay(event.date);
        
        // Populate Flight Logic
        document.getElementById('flight-dest-code').innerText = event.code;
        document.getElementById('flight-dest-name').innerText = event.airportName;
        document.getElementById('flight-origin-name').innerText = USER_ORIGIN_NAME;

        document.getElementById('flight-date-out').innerText = formatDateForDisplay(tripDates.depart);
        document.getElementById('flight-date-ret').innerText = formatDateForDisplay(tripDates.return);

        // Populate Hotel/Car Logic
        document.getElementById('hotel-city-name').innerText = event.city;
        document.getElementById('hotel-area').innerText = `Near ${event.venue}`;
        document.getElementById('hotel-checkin').innerText = formatDateForDisplay(tripDates.depart);
        document.getElementById('car-loc').innerText = `${event.code} Airport`;

        // Populate Insights
        document.getElementById('insight-text').innerText = event.insight;
        document.getElementById('insight-tags').innerHTML = event.tags.map(tag => `<span class="tag">${tag}</span>`).join('');

        toggleView();
    }

    

// 5. CTA Redirection Logic (Updated to YYMMDD format)
function formatDateForSkyscanner(dateStr) {
    const d = new Date(dateStr);
    const yy = d.getFullYear().toString().slice(-2);
    const mm = (d.getMonth() + 1).toString().padStart(2, '0');
    const dd = d.getDate().toString().padStart(2, '0');
    return `${yy}${mm}${dd}`; // Returns format: YYMMDD
}

function searchTravel(type) {
    if (!currentEvent) return; 

    const tripDates = getTripDates(currentEvent.date);
    
    // Using the new YYMMDD format
    const departYYMMDD = formatDateForSkyscanner(tripDates.depart);
    const returnYYMMDD = formatDateForSkyscanner(tripDates.return);

    let url = '';
    
    if (type === 'flights') {
        const origin = USER_ORIGIN_CODE;
        const destination = currentEvent.code;
        // Example URL using the YYMMDD string in the path or query
        url = `https://www.skyscanner.net/transport/flights/${origin}/${destination}/${departYYMMDD}/${returnYYMMDD}/?adults=2&rtn=1`;

    } else if (type === 'hotels') {
        const city = currentEvent.city;
        url = `https://www.skyscanner.net/hotels/${city}-hotels/checkin/${departYYMMDD}/checkout/${returnYYMMDD}?guests=2`;

    } else if (type === 'cars') {
        const airport = currentEvent.code;
        url = `https://www.skyscanner.net/car-hire-search/${airport}/${departYYMMDD}/${returnYYMMDD}?puid=101`;
    }

    if (url) {
        window.open(url, '_blank');
    }
}

    function toggleView() {
        const discovery = document.getElementById('discovery-view');
        const planner = document.getElementById('planner-view');
        
        if (discovery.classList.contains('hidden')) {
            discovery.classList.remove('hidden');
            planner.classList.add('hidden');
            window.scrollTo(0,0);
        } else {
            discovery.classList.add('hidden');
            planner.classList.remove('hidden');
            window.scrollTo(0,0);
        }
    }

    // Initialize
    renderEvents();

</script>

</body>
</html>
